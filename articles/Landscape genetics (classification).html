<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landscape genetics (classification) • mrIML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Landscape genetics (classification)">
<meta property="og:image" content="">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mrIML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Common%20errors%20in%20mrIML.html">Common errors in mrIML</a>
    </li>
    <li>
      <a href="../articles/Swine%20biosecurity.html">Swine Biosecurity working example</a>
    </li>
    <li>
      <a href="../articles/Landscape%20genetics%20(classification).html">Classification working example</a>
    </li>
    <li>
      <a href="../articles/Regression.html">Regression working example</a>
    </li>
    <li>
      <a href="../articles/Landscape%20genetics.html">Landscape genetics</a>
    </li>
    <li>
      <a href="../articles/Graphical%20network%20model%20(GNM).html">Graphical network model (GNM)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nfj1380/mrIML">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Landscape genetics (classification)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nfj1380/mrIML/blob/master/vignettes/Landscape%20genetics%20(classification).Rmd"><code>vignettes/Landscape genetics (classification).Rmd</code></a></small>
      <div class="hidden name"><code>Landscape genetics (classification).Rmd</code></div>

    </div>

    
    
<p>MrIML is a R package allows users to generate and interpret
multi-response models (i.e., joint species distribution models)
leveraging advances in data science and machine learning. MrIML couples
the tidymodel infrastructure developed by Max Kuhn and colleagues with
model agnostic interpretable machine learning tools to gain insights
into multiple response data such as. As such mrIML is flexible and
easily extendable allowing users to construct everything from simple
linear models to tree-based methods for each response using the same
syntax and same way to compare predictive performance. In this vignette
we will guide you through how to apply this package to landscape
genetics problems but keep in mind any multiple-response data can be
interrogated using this package (e.g., species or OTU presence/absence
data).</p>
<p>Let’s start by loading the required packages and data. The data we
are going to use is from Fountain-Jones etal (2017) and consists of
single nucleotide polymorphism (SNP) data from a virus (feline
immunodeficiency virus, FIV) infecting bobcats in Southern
California.</p>
<p>Features (a.k.a predictor variables) with missing data can be removed
or interpolated depending on the nature of the missing data. Here we
remove them.</p>
<p>When constructing these type of models, SNPs that are common (occur
say in &gt;80% of samples) or rare (&lt; 10% of samples) are difficult
to model. This cn be a problem for potentially adaptice loci which tend
to be rarer We provide down-sampling or up-sampling strategies for
dealing with unbalanced data (see below) but filtering out common and
rare loci is another option. The more response variables (SNPs) you
include the longer the computational time, so for this example we will
trim SNPs occurring in &lt; 40% and &gt; 70% of individuals. This leaves
29 SNPs remaining. In practice, these filtering steps are stringent so
&lt; 20 and &gt; 80 maybe more appropriate.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Optional: Filter rare/common SNPs or species. Retaining minor allelle frequncies &gt;0.1 and removing common allelles (occur&gt;0.9)</span></span>
<span><span class="va">fData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterRareCommon.html">filterRareCommon</a></span> <span class="op">(</span><span class="va">Responsedata</span>,</span>
<span>                           lower<span class="op">=</span><span class="fl">0.4</span>,</span>
<span>                           higher<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> </span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">fData</span> <span class="co">#for simplicity when comparing</span></span>
<span><span class="co">#another option at this stage is to filter response that are strongly correlated with each other.</span></span>
<span><span class="co">#df2 &lt;- cor(X) #find correlations</span></span>
<span><span class="co">#hc &lt;-  findCorrelation(df2, cutoff=0.5) # put any value as a "cutoff". </span></span>
<span><span class="co">#hc &lt;-  sort(hc)</span></span>
<span><span class="co">#X &lt;-  X[,-c(hc)] #</span></span></code></pre></div>
<p>If your feature data consists of landscape resistance data generated
from Circuitscape or similar, we provide functionality that can extract
each surface from a folder and generate resistance components that can
be used in these models (using principal coordinate analysis). This data
can be easily merged if needs be with other non-matrix data (e.g.,
age/sex). There was no resistance surfaces here, but this is what the
code looks like:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#R &lt;- resist_components(filename = 'location of pairwise matrices', p_val=0.01 ) # p values are used here to filter resistance components that aren't correlated with th original pairwise matrix.</span></span>
<span><span class="co">#X&lt;- cbind(R,X)</span></span></code></pre></div>
<p>Now all the data is loaded and ready to go we can formulate the model
using tidymodel syntax. In this case we have binary data (SNP
presence/absence at each loci) but the data could also be counts or
continuous (the set_model argument would be “regression” instead of
“classification”). The user can specify any model from the tidymodel
universe as ‘model 1’ (see <a href="https://www.tidymodels.org/find/" class="external-link uri">https://www.tidymodels.org/find/</a> for details). However,
we have done most of our testing on random forests (rf), xgr boost and
glms (generalized linear models). Here we will specify a random forest
classification model as the model applied to each response.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_rf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">100</span>,</span>
<span>              mode <span class="op">=</span> <span class="st">"classification"</span>,</span>
<span>              mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>              min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co">#100 trees are set for brevity. Aim to start with 1000</span></span>
<span>             <span class="fu">set_engine</span><span class="op">(</span><span class="st">"randomForest"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can run the model. Hyper parameter tuning (for algorithms that
have hyper parameters) is done automatically by testing how model
performance changes across a random grid of 10 parameters and the best
performing combination is kept. The only choice to make is to either
down/up sample data or leave it as is. As our viral data set is small,
we will not do any up or down-sampling (option ‘no’). We could also
implement parallel processing for larger data sets.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">cluster</span>, workers<span class="op">=</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="va">yhats_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X</span>,</span>
<span>                           Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                           Model<span class="op">=</span><span class="va">model_rf</span>,</span>
<span>                           balance_data<span class="op">=</span><span class="st">'no'</span>,</span>
<span>                           mode<span class="op">=</span><span class="st">'classification'</span>,</span>
<span>                          tune_grid_size<span class="op">=</span><span class="fl">5</span>, k<span class="op">=</span><span class="fl">5</span>,</span>
<span>                          seed <span class="op">=</span> <span class="fl">123</span>, racing<span class="op">=</span><span class="cn">F</span> <span class="op">)</span> <span class="co">## in MrTidymodels. Balanced </span></span></code></pre></div>
<p>It takes a couple of minutes to run on a laptop and there are
warnings that you can ignore (this data set is small). The above code
constructs tuned random forest models for the features (Y) you have
selected for each response (29 viral SNP in this case). We can then
check the performance of each model separately and overall. The
performance metrics we provide for classification models are area under
curve (roc_AUC), Mathew’s correlation coefficient (MCC - a good metric
when data is imbalanced i.e., unequal numbers of 0/1s in each response),
specificity (proportion correctly classified not having the mutation at
that loci) and sensitivity (proportion correctly classified having the
mutation at that loci). We also provide ‘prevalence’ that tells you how
common that SNP was in the population sampled.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ModelPerf_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_rf</span>,</span>
<span>                                 Model<span class="op">=</span><span class="va">model_rf</span>,</span>
<span>                                 Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                                 mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span></span>
<span><span class="va">ModelPerf_rf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#predictive performance for individual responses </span></span>
<span><span class="co">#&gt;    response  model_name            roc_AUC                mcc       sensitivity</span></span>
<span><span class="co">#&gt; 1   env_131 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 2   env_163 rand_forest  0.238095238095238 -0.327326835353989                 0</span></span>
<span><span class="co">#&gt; 3   env_164 rand_forest  0.895833333333333  0.534522483824849               0.5</span></span>
<span><span class="co">#&gt; 4   env_167 rand_forest  0.833333333333333               &lt;NA&gt;                 1</span></span>
<span><span class="co">#&gt; 5   env_169 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 6   env_212 rand_forest  0.444444444444444  0.272165526975909                 1</span></span>
<span><span class="co">#&gt; 7    env_23 rand_forest               0.48 -0.333333333333333                 0</span></span>
<span><span class="co">#&gt; 8    env_24 rand_forest               0.28               &lt;NA&gt;                 1</span></span>
<span><span class="co">#&gt; 9    env_41 rand_forest  0.208333333333333 -0.408248290463863 0.333333333333333</span></span>
<span><span class="co">#&gt; 10   env_47 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt; 11   env_59 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 12    env_8 rand_forest            0.78125               &lt;NA&gt;                 0</span></span>
<span><span class="co">#&gt; 13   env_84 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 14   env_85 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 15   env_86 rand_forest             0.4375               &lt;NA&gt;                 1</span></span>
<span><span class="co">#&gt; 16  pol_105 rand_forest  0.854166666666667  0.408248290463863 0.333333333333333</span></span>
<span><span class="co">#&gt; 17  pol_108 rand_forest  0.761904761904762  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 18  pol_111 rand_forest  0.895833333333333  0.534522483824849               0.5</span></span>
<span><span class="co">#&gt; 19  pol_117 rand_forest               0.78  0.654653670707977                 1</span></span>
<span><span class="co">#&gt; 20  pol_132 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt; 21  pol_159 rand_forest               0.28  0.333333333333333                 1</span></span>
<span><span class="co">#&gt; 22  pol_258 rand_forest 0.0833333333333333 -0.356348322549899               0.5</span></span>
<span><span class="co">#&gt; 23   pol_30 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt; 24  pol_340 rand_forest 0.0952380952380952 -0.218217890235992 0.142857142857143</span></span>
<span><span class="co">#&gt; 25  pol_353 rand_forest             0.4375               &lt;NA&gt;                 1</span></span>
<span><span class="co">#&gt; 26  pol_366 rand_forest  0.642857142857143  0.327326835353989 0.285714285714286</span></span>
<span><span class="co">#&gt; 27   pol_87 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt; 28   pol_88 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt; 29   pol_89 rand_forest               0.86  0.816496580927726                 1</span></span>
<span><span class="co">#&gt;                  ppv       specificity        prevalence</span></span>
<span><span class="co">#&gt; 1                  1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 2  0.714285714285714                 0 0.631578947368421</span></span>
<span><span class="co">#&gt; 3                  1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 4                  0               0.4 0.421052631578947</span></span>
<span><span class="co">#&gt; 5                  1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 6  0.444444444444444 0.166666666666667 0.684210526315789</span></span>
<span><span class="co">#&gt; 7                0.8                 0 0.631578947368421</span></span>
<span><span class="co">#&gt; 8                  0               0.5 0.421052631578947</span></span>
<span><span class="co">#&gt; 9               0.25               0.4 0.473684210526316</span></span>
<span><span class="co">#&gt; 10               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="co">#&gt; 11                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 12                 1               NaN 0.473684210526316</span></span>
<span><span class="co">#&gt; 13                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 14                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 15                 0               0.4 0.421052631578947</span></span>
<span><span class="co">#&gt; 16                 1                 1 0.473684210526316</span></span>
<span><span class="co">#&gt; 17                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 18                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 19               0.6 0.714285714285714 0.473684210526316</span></span>
<span><span class="co">#&gt; 20               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="co">#&gt; 21               0.2 0.555555555555556 0.473684210526316</span></span>
<span><span class="co">#&gt; 22 0.166666666666667 0.285714285714286 0.473684210526316</span></span>
<span><span class="co">#&gt; 23               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="co">#&gt; 24 0.666666666666667               0.5 0.421052631578947</span></span>
<span><span class="co">#&gt; 25                 0               0.4 0.421052631578947</span></span>
<span><span class="co">#&gt; 26                 1                 1 0.421052631578947</span></span>
<span><span class="co">#&gt; 27               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="co">#&gt; 28               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="co">#&gt; 29               0.8 0.833333333333333 0.473684210526316</span></span>
<span><span class="va">ModelPerf_rf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="co">#overall predictive performance</span></span>
<span><span class="co">#&gt; [1] 0.2856634</span></span></code></pre></div>
<p>You can compare the predictive performance of random forests with any
other technique simply by altering the following. Lets try a logistic
regression. Note that for logistic regression you may need to
scale/transform the data or create dummy variables if you include
categorical variables. These steps can easily be added to the pipeline
following tidymodel syntax (see the website above)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_glm</span> <span class="op">&lt;-</span> <span class="co">#model used to generate yhat</span></span>
<span>  <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">yhats_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X</span>,</span>
<span>                           Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                           Model<span class="op">=</span><span class="va">model_glm</span>,</span>
<span>                           balance_data<span class="op">=</span><span class="st">'no'</span>,</span>
<span>                           mode<span class="op">=</span><span class="st">'classification'</span>,</span>
<span>                           tune_grid_size<span class="op">=</span><span class="fl">5</span>,</span>
<span>                           seed <span class="op">=</span><span class="fl">123</span>,</span>
<span>                           racing<span class="op">=</span><span class="cn">F</span>,</span>
<span>                           k<span class="op">=</span><span class="fl">5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==                                                                    |   3%  |                                                                              |=====                                                                 |   7%  |                                                                              |=======                                                               |  10%  |                                                                              |==========                                                            |  14%  |                                                                              |============                                                          |  17%  |                                                                              |==============                                                        |  21%  |                                                                              |=================                                                     |  24%  |                                                                              |===================                                                   |  28%  |                                                                              |======================                                                |  31%  |                                                                              |========================                                              |  34%  |                                                                              |===========================                                           |  38%  |                                                                              |=============================                                         |  41%  |                                                                              |===============================                                       |  45%  |                                                                              |==================================                                    |  48%  |                                                                              |====================================                                  |  52%  |                                                                              |=======================================                               |  55%  |                                                                              |=========================================                             |  59%  |                                                                              |===========================================                           |  62%  |                                                                              |==============================================                        |  66%  |                                                                              |================================================                      |  69%  |                                                                              |===================================================                   |  72%  |                                                                              |=====================================================                 |  76%  |                                                                              |========================================================              |  79%  |                                                                              |==========================================================            |  83%  |                                                                              |============================================================          |  86%  |                                                                              |===============================================================       |  90%  |                                                                              |=================================================================     |  93%  |                                                                              |====================================================================  |  97%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="co">#save(yhats, file='logreg_model')</span></span>
<span><span class="va">ModelPerf_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_glm</span>,</span>
<span>                                  Model<span class="op">=</span><span class="va">model_glm</span>,</span>
<span>                                  Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                                  mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span> <span class="co">#</span></span>
<span><span class="va">ModelPerf_glm</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] -0.1385518</span></span></code></pre></div>
<p>You can see that the random forests model outperforms the logistic
regression in this case. Once we are happy with the underlying model we
can then dive in to see how this model predicts the SNPs. First we can
check out variable importance.The first plot is the global importance
(what features shape genetic change overall), the second shows the
individual models (with an optional importance MCC threshold ‘cutoff’
value ). We also provide functionality to assess outlier SNPs utilizing
a PCA on importance scores. We can see only one outlier was detected on
PC3 (env24) indicating that this SNP was bets predicted by a different
set of predictors. Looking at the indiivudal importance plots shows
that, unlike the other SNPs, forest cover was the best predictor for
env24. See the regression vignette for more details.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_impVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrVip.html">mrvip</a></span><span class="op">(</span></span>
<span>  yhats <span class="op">=</span> <span class="va">yhats_glm</span>,</span>
<span>  mrBootstrap_obj <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  X1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"classification"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  global_top_var <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  local_top_var <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  taxa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ModelPerf <span class="op">=</span> <span class="va">ModelPerf_glm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "here"</span></span>
<span></span>
<span><span class="va">glm_impVI</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="co">#importance</span></span></code></pre></div>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_impVI</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="co">#PCA</span></span></code></pre></div>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-7-2.png" width="768" style="display: block; margin: auto;">
If your features can be grouped together this can make it easier to
interpret variable importance plots. The order of the groups should
match the order of the columns in the X data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#for example</span></span>
<span><span class="va">groupCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span> <span class="op">(</span><span class="st">"Host_characteristics"</span>, <span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Urbanisation"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Vegetation"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Urbanisation"</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Spatial"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'Host_relatedness'</span>, <span class="fl">6</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span> <span class="op">(</span><span class="st">"Host_characteristics"</span>, <span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Vegetation"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Urbanisation"</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>MrIML allows a full suite of model agnostic interpretable machine
learning tools to be applied to individual models or the ‘global’ set.
We utilize the R package flashlight which offers an exciting and ever
growing tool set to interpret these models: <a href="https://cran.r-project.org/web/packages/flashlight/vignettes/flashlight.html" class="external-link uri">https://cran.r-project.org/web/packages/flashlight/vignettes/flashlight.html</a></p>
<p>For example, once we create the flashlight objects, we can plot the
predicted values of a feature for each response.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrFlashlight.html">mrFlashlight</a></span><span class="op">(</span><span class="va">yhats_rf</span>,</span>
<span>                   X<span class="op">=</span><span class="va">X</span>,</span>
<span>                   Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                   response <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>                   index<span class="op">=</span><span class="fl">1</span>,</span>
<span>                   mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span> <span class="co">#index pointing to the SNP of interest (i.e. the first column)</span></span>
<span></span>
<span><span class="va">mfl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrFlashlight.html">mrFlashlight</a></span><span class="op">(</span><span class="va">yhats_rf</span>,</span>
<span>                    X<span class="op">=</span><span class="va">X</span>,</span>
<span>                    Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                    response <span class="op">=</span> <span class="st">"multi"</span>,</span>
<span>                    mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span> <span class="co">#the global set</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">light_scatter</span><span class="op">(</span><span class="va">fl</span>,</span>
<span>                   v <span class="op">=</span> <span class="st">"Grassland"</span>,</span>
<span>                   type <span class="op">=</span> <span class="st">"predicted"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;">
We also wrap some flashlight functionality to visualize the marginal
(i.e. partial dependencies) or conditional (accumulated local effects)
effect of a feature on genetic change. Partial dependencies take longer
to calculate and are more sensitive to correlated features. The first
plot You can see here that they can get different results based on which
plot you use. ALE plots are a better option if your feature set is even
moderately impacted by collinearity ( e.g., rho = 0.6). The second plot
is the overall smoothed genetic-turnover function.</p>
<p>When running this code yourself, you need to change ‘v’ to the
variable of interest within your Y dataset.In this case we are looking
at how grassland shapes genetic turnover.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profileData_pd</span> <span class="op">&lt;-</span> <span class="fu">light_profile</span><span class="op">(</span><span class="va">mfl</span>,</span>
<span>                                v <span class="op">=</span> <span class="st">"Grassland"</span><span class="op">)</span> <span class="co">#partial dependencies</span></span>
<span><span class="va">profileData_ale</span> <span class="op">&lt;-</span> <span class="fu">light_profile</span><span class="op">(</span><span class="va">mfl</span>,</span>
<span>                                 v <span class="op">=</span> <span class="st">"Grassland"</span>,</span>
<span>                                 type <span class="op">=</span> <span class="st">"ale"</span><span class="op">)</span> <span class="co">#acumulated local effects</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mrProfileplot.html">mrProfileplot</a></span><span class="op">(</span><span class="va">profileData_pd</span>, sdthresh <span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="co">#sdthresh removes responses from the first plot that do not vary with the feature</span></span></code></pre></div>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt;  Press [enter] to continue to the global summary plot</span></span></code></pre>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-10-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mrProfileplot.html">mrProfileplot</a></span><span class="op">(</span><span class="va">profileData_ale</span>, sdthresh <span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-10-3.png" width="768" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt;  Press [enter] to continue to the global summary plot</span></span></code></pre>
<p><img src="Landscape%20genetics%20(classification)_files/figure-html/unnamed-chunk-10-4.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#the second plot is the cumulative turnover function</span></span></code></pre></div>
<p>Finally, we can assess how features interact overall to shape genetic
change. Be warned this is memory intensive. Future updates to this
package will enable users to visualize these interactions and explore
them in more detail using 2D ALE plots for example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interactions</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/mrInteractions.html">mrInteractions</a></span><span class="op">(</span>yhats<span class="op">=</span><span class="va">yhats_rf</span>,</span>
<span>                              feature<span class="op">=</span><span class="st">'Forest'</span>,</span>
<span>                              X<span class="op">=</span><span class="va">X</span>,</span>
<span>                              Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>                              num_bootstrap<span class="op">=</span><span class="fl">1</span>,</span>
<span>                              top.int<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co">#this is computationally intensive so multicore are needed. </span></span></code></pre></div>
<p>You could easily compare the plots generated above from our random
forest model with the logistic regression model we also calculated.</p>
<p>You can visualize detected interactions by converting the MrIML
predicts object into a form suitable for the R package IML (<a href="https://cran.r-project.org/web/packages/iml/vignettes/intro.html" class="external-link uri">https://cran.r-project.org/web/packages/iml/vignettes/intro.html</a>)
using ‘MrIMLconverts’. You can plot how two features interact to shape
genetic change using ‘mrProfile2D’. In effect, this heatmap shows the
average prediction of the interacting features across loci/response
variables. ALEs or partial dependencies can be used - but we highly
recommend using ALEs for the most robust results (see Molnar (2019) for
more detail)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrIMLconverts_list</span> <span class="op">&lt;-</span> <span class="fu">MrIMLconverts</span><span class="op">(</span>yhats<span class="op">=</span><span class="va">yhats_glm</span>,</span>
<span>                                    X<span class="op">=</span><span class="va">X</span>,</span>
<span>                                    mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">featureA</span> <span class="op">=</span> <span class="st">'Forest'</span></span>
<span><span class="va">featureB</span> <span class="op">=</span> <span class="st">'Grassland'</span></span>
<span></span>
<span><span class="va">p2d</span> <span class="op">&lt;-</span> <span class="fu">mrProfile2D</span> <span class="op">(</span><span class="va">mrIMLconverts_list</span>, <span class="va">featureA</span>, </span>
<span>                <span class="va">featureB</span>,  mode<span class="op">=</span><span class="st">'classification'</span>,</span>
<span>                grid.size<span class="op">=</span><span class="fl">30</span>, method <span class="op">=</span> <span class="st">'ale'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p2d</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This is just an example of the tools can be applied to better
interpret multi-response models and in turn gain insights into how
landscape impacts genetic change. We’ve demonstrated that this package
is modular and flexible, allowing future work on ‘tidymodels’ and
interpretable machine learning to easily be incorporated. The
predictions from these models, for example, can be used to identify
individual SNPs that may be adaptive assess gene flow across space
(future updates) or to help better formulate probabilistic models such
as generalized dissimilarity models (GDMs).</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://discover.utas.edu.au/Nick.FountainJones" class="external-link">Nick Fountain-Jone</a>, <a href="https://machado-lab.github.io/" class="external-link">Gustavo Machado</a>, Chris Kozakiewicz, Nick Clark.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
